
backend projesini kald캼rma:
     dotnet build -> dotnet run


npm install @mantine/core @mantine/hook 

tailwindcss -> 
    npm install -D tailwindcss@3.4.17 (s칲r칲m uyu릀azl캼캼 i칞in)
    npx tailwindcss init (tailwind.config.js dosyas캼n캼 olu릆urmak i칞in)


git pull origin main -> de를를klikleri repository'den 칞eker

git add . -> projedeki de를를klerin t칲m칲n칲n칲 ekler
git commit -m "message" -> commit mesaj캼 (s칲r칲m)
git push origin main -> commit'i repository'e ekler



PROJE EKLEME EKRANI
proje (string max 250 karakter)
s칲re칞 (string combobox)
g칬rev (string textbox max 250 karakter)
kullan캼c캼 (kullan캼c캼lar combobox)
ba륿ama biti tarihleri (date,date)
son de를릆iren kullan캼c캼 (giri yapan ki를nin bilgileri)
son de를릆irme tarih ve saaat (yap캼lan i륿em tarihi)
durum (combobox) (i칞erisinde yap캼lacak devam ediyor bitti iptal) 
칬nem s캼ras캼 (칬ncelik d칲칲k orta y칲ksek kritik)

PROJE DETAY SAYFASI
proje ad캼
s칲re칞
g칬rev
kullan캼c캼 bilgisi
칬ncelik durumu
durum
ba륿ama ve biti tarihi
proje detay a칞캼klamas캼 (string max 500)
dosya ekleme


PROJE EKRANLARI
    -> Proje ekleme ekran캼 (Projects ve ProjectTasks tablosuna ayn캼 anda post atacak)
    -> Proje Listeleme (Eklenen Projeler G칬r칲nt칲lenecek, t칲m alanlar g칬r칲nt칲lenmeyecek, proje detay butonu olacak
    butona t캼kland캼캼nda proje detay sayfas캼 a칞캼lacak)
    -> Proje Detay (Proje ekleme ekran캼nda girilen t칲m bilgiler g칬r칲nt칲lenecek)



dashboarda g칬r칲nt칲lenecekler:
projelerin durumlar캼 -> biten devam eden ba륿an캼lacaklar(opsiyonel)


Proje ekleme sayfas캼
-Proje adresi -> il il칞e mahalle ada parsel
-(Panel say캼s캼 * panel g칲c칲) / 1000  = kWp
-Adres: 룐hir, il칞e, mahalle, ada parsel (칞oklu se칞im),

Process se칞me ekran캼
-tasklar de를l s칲re칞ler bir kullan캼c캼ya atanacak(t칲m g칬revleri bir ki를 kontrol edecek)

Task ekran캼
-task ekran캼nda t칲m bilgiler ayn캼 ekranda g칬r칲necek (modal 른klinde de를l)

dashboard
-raporlamalar g칬r칲nt칲lenecek
-hangi projenin hangi s칲reci y칲zde ka칞 tamamland캼 grafi를
-toplam yap캼lan projelerin g칲칞leri
-y칬netici bazl캼 raporlar olu릆urma 
------------------------------------------------------------------------------------------------------------------------------
Proje Kart
-Proje ad캼
-a칞캼klamas캼
-ba륿ama biti tarihi
-durumu
-DC ve AC de른ri (DC g칲c칲 form칲l ile hesaplanacak-> (Panel say캼s캼 * panel g칲c칲) / 1000  = kWp ) (de를릆irilemez olacak)
-panel g칲c칲 ve say캼s캼
-inv칬rter say캼 ve g칲칞.
-proje lokasyon il/il칞e
-Ek yap캼 varsa DC de른ri g칬sterilecek
-proje tadilat veya DC g칲칞 art캼캼 ise sa 칲st k칬른de g칬sterilir.

PROJE EKLE
-DC VE AC DE뢴RLER캻
-캻L 캻L칂E MAHALLE ADA PARSEL
-PROJE T칖R칖


<TextInput label="Proje Ad캼" value={formData.name} onChange={(e) => setFormData({ ...formData, name: e.currentTarget.value })} />
      <Textarea label="A칞캼klama" value={formData.description} onChange={(e) => setFormData({ ...formData, description: e.currentTarget.value })} />
      <div className="grid grid-cols-2 gap-4">
        <input type="date" value={formData.startDate.split("T")[0]} onChange={(e) => setFormData({ ...formData, startDate: e.target.value })} />
        <input type="date" value={formData.endDate.split("T")[0]} onChange={(e) => setFormData({ ...formData, endDate: e.target.value })} />
      </div>
      <Select label="Durum" data={[{ value: "isPlanned", label: "Planlan캼yor" }, { value: "ToDo", label: "Yap캼l캼yor" }, { value: "Done", label: "Tamamland캼" }, { value: "Canceled", label: "캻ptal" }]} value={formData.status} onChange={(e) => setFormData({ ...formData, status: e })} />
      <Select label="칐nem" data={[{ value: "Low", label: "D칲칲k" }, { value: "Medium", label: "Orta" }, { value: "High", label: "Y칲ksek" }, { value: "Critical", label: "Kritik" }]} value={formData.priority} onChange={(e) => setFormData({ ...formData, priority: e })} />
      <Select label="Proje T칲r칲" data={projectTypes} value={formData.projectTypeId.toString()} onChange={(e) => setFormData({ ...formData, projectTypeId: Number(e) })} />
      <Select label="룐hir" data={cities} value={formData.address.cityId.toString()} onChange={(e) => setFormData({ ...formData, address: { ...formData.address, cityId: Number(e), districtId: 0, neighborhoodId: 0 } })} />
      <Select label="캻l칞e" data={districts} value={formData.address.districtId.toString()} onChange={(e) => setFormData({ ...formData, address: { ...formData.address, districtId: Number(e), neighborhoodId: 0 } })} />
      <Select label="Mahalle" data={neighborhood} value={formData.address.neighborhoodId.toString()} onChange={(e) => setFormData({ ...formData, address: { ...formData.address, neighborhoodId: Number(e) } })} />
      <TextInput label="Ada" value={formData.address.ada} onChange={(e) => setFormData({ ...formData, address: { ...formData.address, ada: e.currentTarget.value } })} />
      <TextInput label="Parsel" value={formData.address.parsel} onChange={(e) => setFormData({ ...formData, address: { ...formData.address, parsel: e.currentTarget.value } })} />
      <TextInput label="Panel Say캼s캼" value={formData.panelCount} onChange={(e) => setFormData({ ...formData, panelCount: e.currentTarget.value })} />
      <TextInput label="Panel G칲c칲" value={formData.panelPower} onChange={(e) => setFormData({ ...formData, panelPower: e.currentTarget.value })} />
      <Select label="Panel Markas캼" data={panelBrand} value={formData.panelBrandId.toString()} onChange={(e) => setFormData({ ...formData, panelBrandId: Number(e) })} />
      <TextInput label="DC (kWp)" value={formData.dcValue} readOnly />
      <TextInput label="캻nverter Say캼s캼" value={formData.inverterCount} onChange={(e) => setFormData({ ...formData, inverterCount: e.currentTarget.value })} />
      <TextInput label="캻nverter G칲c칲" value={formData.inverterPower} onChange={(e) => setFormData({ ...formData, inverterPower: e.currentTarget.value })} />
      <Select label="캻nverter Markas캼" data={inverterBrand} value={formData.inverterBrandId.toString()} onChange={(e) => setFormData({ ...formData, inverterBrandId: Number(e) })} />
      <TextInput label="AC (kWe)" value={formData.acValue} onChange={(e) => setFormData({ ...formData, acValue: e.currentTarget.value })} />

      <Checkbox label="Ek Yap캼 m캼?" checked={hasEkYapi} onChange={(e) => {
        const checked = e.currentTarget.checked;
        setHasEkYapi(checked);
        setFormData({ ...formData, hasAdditionalStructure: checked });
      }} />

      {hasEkYapi && (
        <div className="grid grid-cols-3 gap-4">
          <TextInput label="Ek Panel Say캼s캼" value={formData.additionalPanelCount} onChange={(e) => setFormData({ ...formData, additionalPanelCount: Number(e.currentTarget.value) })} />
          <TextInput label="Ek Panel G칲c칲" value={formData.additionalPanelPower} onChange={(e) => setFormData({ ...formData, additionalPanelPower: Number(e.currentTarget.value) })} />
          <TextInput label="Ek 캻nverter Say캼s캼" value={formData.additionalInverterCount} onChange={(e) => setFormData({ ...formData, additionalInverterCount: Number(e.currentTarget.value) })} />
        </div>
      )}

      <Button className="bg-green-500" onClick={handleSubmit}>Projeyi Kaydet</Button>
    </div>

    ---------------------------------------------------------

    const [hasEkYapi, setHasEkYapi] = useState(false);
  const [cities, setCities] = useState([]);
  const [districts, setDistricts] = useState([]);
  const [neighborhood, setNeighborhood] = useState([]);
  const [projectTypes,setProjectTypes] = useState([]);
  const [panelBrand,setPanelBrand] = useState([]);
  const [inverterBrand,setInverterBrand] = useState([]);


  const [formData, setFormData] = useState({
  name: "",
  description: "",
  startDate: new Date().toISOString().split("T")[0], // 游릭 bug칲n칲n tarihi
  endDate: "",
  priority: "Low",
  status: "isPlanned", // 游릭 varsay캼lan durum
  panelCount: 0,
  panelPower: 0,
  panelBrandId: 1, // 游릭 varsay캼lan panel markas캼
  inverterCount: 0,
  inverterPower: 0,
  inverterBrandId: 1, // 游릭 varsay캼lan inverter markas캼
  hasAdditionalStructure: true,
  additionalPanelCount: 0,
  additionalInverterCount: 0,
  acValue: 0,
  dcValue: 0,
  cityId: null,
  districtId: null,
  neighborhoodId: null,
  ada: "0",
  parsel: "0",
  projectTypeId: 1, // 游릭 varsay캼lan proje t칲r칲
  createdAt: new Date().toISOString(),
  createdByUserId: 1,
  updatedAt: null,
  updatedByUserId: 0
});


  // proje t칲rlerini getirme
  useEffect(() => {
    const fetchProjectTypes = async () => {
      try{
        const token = localStorage.getItem("token");
        const response = await axios.get("http://localhost:5000/api/projectTypes", {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        });

        const projectTypesOptions = response.data.map((types) => ({
          value: types.id.toString(),
          label: types.name,
        }));

        setProjectTypes(projectTypesOptions);
      }catch(error){
        console.error("Proje T칲r칲 Verileri al캼nmad캼: ", error );
      }
    };

    fetchProjectTypes();
  },[])

   // panel markalar캼 getirme
  useEffect(() => {
    const fetchPanelBrand = async () => {
      try{
        const token = localStorage.getItem("token");
        const response = await axios.get("http://localhost:5000/api/panelBrands", {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        });

        const panelBrandsOptions = response.data.map((panel) => ({
          value: panel.id.toString(),
          label: panel.name,
        }));

        setPanelBrand(panelBrandsOptions);
      }catch(error){
        console.error("Proje T칲r칲 Verileri al캼nmad캼: ", error );
      }
    };

    fetchPanelBrand();
  },[])

  // panel markalar캼 getirme
  useEffect(() => {
    const fetchInverterBrand = async () => {
      try{
        const token = localStorage.getItem("token");
        const response = await axios.get("http://localhost:5000/api/InverterBrands", {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        });

        const inverterBrandsOptions = response.data.map((inverter) => ({
          value: inverter.id.toString(),
          label: inverter.name,
        }));

        setInverterBrand(inverterBrandsOptions);
      }catch(error){
        console.error("Proje T칲r칲 Verileri al캼nmad캼: ", error );
      }
    };

    fetchInverterBrand();
  },[])


  // 른hirleri getirme
  useEffect(() => {
    const fetchCities = async () => {
      try {
        const token = localStorage.getItem("token");
        const response = await axios.get("http://localhost:5000/api/cities", {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        });

        const cityOptions = response.data.map((city) => ({
          value: city.id.toString(), // Mantine Select i칞in string olmal캼
          label: city.name,
        }));

        setCities(cityOptions);
      } catch (error) {
        console.error("룐hir verileri al캼namad캼:", error);
      }
    };
    fetchCities();
  }, []);

  // 른hire g칬re il칞eleri getir
  useEffect(() => {
    const fetchDistricts = async () => {
      if (!formData.cityId) return;

      try {
        const token = localStorage.getItem("token");
        const response = await axios.get(`http://localhost:5000/api/cities/by-districts/${formData.cityId}`, {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        });

        const districtOptions = response.data.map((district) => ({
          value: district.id.toString(),
          label: district.name,
        }));

        setDistricts(districtOptions);
      } catch (error) {
        console.error("캻l칞e verileri al캼namad캼:", error);
      }
    };

    fetchDistricts();
  }, [formData.cityId]);

  //il칞eye g칬re mahalle getirme
  useEffect(() => {
    const fetchNeighborhoods = async () => {
      if (!formData.districtId) return;
      try {
        const token = localStorage.getItem("token");
        const response = await axios.get(`http://localhost:5000/api/districts/by-neighborhoods/${formData.districtId}`, {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        });

        const neighborhoodsOptions = response.data.map((neighborhood) => ({
          value: neighborhood.id.toString(),
          label: neighborhood.name,
        }));

        setNeighborhood(neighborhoodsOptions);
      } catch (error) {
        console.error("Mahalle verileri al캼nmad캼: ", error);
      }
    };

    fetchNeighborhoods();
  }, [formData.districtId]);

  // dc de른ri hesaplama
  useEffect(() => {
  const count = parseFloat(formData.panelCount) || 0;
  const power = parseFloat(formData.panelPower) || 0;
  const dc = (count * power) / 1000;
  setFormData((prev) => ({ ...prev, dcValue: dc.toFixed(2) }));
}, [formData.panelCount, formData.panelPower]);





import React, { useEffect, useState } from "react";
import axios from "axios";
import { Text, Badge, Card, Group, Stack, Divider, LoadingOverlay, ActionIcon, Tooltip } from "@mantine/core";
import { IconCalendar, IconMapPin, IconBolt, IconSolarPanel, IconCpu, IconPlus, IconInfoCircle } from "@tabler/icons-react";
import ProjectDetails from "./ProjectDetails";
import ProjectFilters from "../components/Project/ProjectFilters";
import { useNavigate } from "react-router-dom";

const Projects = () => {
  const [projects, setProjects] = useState([]);
  const [cities, setCities] = useState([]);
  const [districts, setDistricts] = useState([]);
  const [projectTypes, setProjectTypes] = useState([]);
  const [searchTerm, setSearchTerm] = useState("");
  const [sortField, setSortField] = useState("startDate");
  const [sortOrder, setSortOrder] = useState("asc");
  const [selectedProjectId, setSelectedProjectId] = useState(null);
  const [modalOpen, setModalOpen] = useState(false);
  const [loading, setLoading] = useState(true);
  const navigate = useNavigate();

  useEffect(() => {
    const token = localStorage.getItem("token");

    const fetchAll = async () => {
      try {
        setLoading(true);
        const [projectRes, cityRes, districtRes, typeRes] = await Promise.all([
          axios.get("http://localhost:5000/api/projects", { headers: { Authorization: `Bearer ${token}` } }),
          axios.get("http://localhost:5000/api/cities", { headers: { Authorization: `Bearer ${token}` } }),
          axios.get("http://localhost:5000/api/districts", { headers: { Authorization: `Bearer ${token}` } }),
          axios.get("http://localhost:5000/api/projectTypes", { headers: { Authorization: `Bearer ${token}` } }),
        ]);

        setProjects(projectRes.data);
        setCities(cityRes.data);
        setDistricts(districtRes.data);
        setProjectTypes(typeRes.data);
      } catch (err) {
        console.error("Veriler al캼namad캼:", err);
      } finally {
        setLoading(false);
      }
    };

    fetchAll();
  }, []);

  const formatDate = (dateStr) => {
    if (!dateStr) return "-";
    const date = new Date(dateStr);
    return date.toLocaleDateString("tr-TR");
  };

  const getCityName = (id) => cities.find((c) => c.id === id)?.name || `룐hir ID: ${id}`;
  const getDistrictName = (id) => districts.find((d) => d.id === id)?.name || `캻l칞e ID: ${id}`;
  const getProjectTypeName = (id) => projectTypes.find((p) => p.id === id)?.name || `T칲r ID: ${id}`;

  const priorityConfig = {
    Low: { color: "blue", label: "D칲칲k" },
    Medium: { color: "green", label: "Orta" },
    High: { color: "orange", label: "Y칲ksek" },
    Critical: { color: "red", label: "Kritik" },
  };

  const statusConfig = {
    "Active": { color: "blue", label: "Planlama" },
    "Passive": { color: "yellow", label: "Devam Ediyor" },
    "Completed": { color: "green", label: "Tamamland캼" },
    "Cancelled": { color: "red", label: "캻ptal Edildi" },
  };

  const priorityOrderMap = {
    Low: 1,
    Medium: 2,
    High: 3,
    Critical: 4,
  };

  const filteredProjects = projects
    .filter((project) => {
      const valuesToSearch = [
        project.name,
        project.description,
        project.startDate,
        project.endDate,
        project.priority,
        project.status,
      ];
      return valuesToSearch.some((field) =>
        field?.toString().toLowerCase().includes(searchTerm.toLowerCase())
      );
    })
    .sort((a, b) => {
      let aVal, bVal;
      if (sortField === "priority") {
        aVal = priorityOrderMap[a.priority] || 0;
        bVal = priorityOrderMap[b.priority] || 0;
      } else {
        aVal = new Date(a[sortField]);
        bVal = new Date(b[sortField]);
      }
      return sortOrder === "asc" ? aVal - bVal : bVal - aVal;
    });

  const handleCardClick = (projectId) => {
    setSelectedProjectId(projectId);
    setModalOpen(true);
  };

  const InfoItem = ({ icon: Icon, label, value, color = "gray" }) => (
    <Group gap="xs" wrap="nowrap">
      <Icon size={16} color={color} />
      <Stack gap={0}>
        <Text size="xs" c="dimmed" fw={500}>
          {label}
        </Text>
        <Text size="sm" fw={600}>
          {value}
        </Text>
      </Stack>
    </Group>
  );

  const PowerCard = ({ title, value, unit, icon: Icon }) => (
    <Card withBorder padding="sm" radius="md" bg="gray.0">
      <Group gap="xs" justify="space-between">
        <Stack gap={0}>
          <Text size="xs" c="dimmed" fw={500}>
            {title}
          </Text>
          <Group gap="xs">
            <Text size="lg" fw={700} c="dark">
              {value || 0}
            </Text>
            <Text size="sm" c="dimmed">
              {unit}
            </Text>
          </Group>
        </Stack>
        <Icon size={24} color="var(--mantine-color-blue-6)" />
      </Group>
    </Card>
  );

  if (loading) {
    return (
      <div className="p-4 sm:p-6 relative min-h-96">
        <LoadingOverlay visible={loading} />
      </div>
    );
  }

  return (
    <div className="p-4 sm:p-6">
      <ProjectFilters
        searchTerm={searchTerm}
        onSearchChange={setSearchTerm}
        sortField={sortField}
        onSortFieldChange={setSortField}
        sortOrder={sortOrder}
        onSortOrderChange={setSortOrder}
      />

      <div className="flex justify-between items-center my-6">
        <div>
          <Text size="xl" fw={700} c="dark">
            Projeler
          </Text>
          <Text size="sm" c="dimmed">
            {filteredProjects.length} proje bulundu
          </Text>
        </div>
        <button
          onClick={() => navigate("/projectCreated")}
          className="bg-gradient-to-r from-blue-500 to-blue-600 text-white px-6 py-3 rounded-lg shadow-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 flex items-center gap-2 font-semibold"
        >
          <IconPlus size={20} />
          Yeni Proje Ekle
        </button>
      </div>

      <div className="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 2xl:grid-cols-4 gap-6">
        {filteredProjects.length === 0 ? (
          <div className="col-span-full text-center py-12">
            <Text size="lg" c="dimmed">
              Arama sonucu bulunamad캼.
            </Text>
          </div>
        ) : (
          filteredProjects.map((project) => (
            <Card
              key={project.id}
              onClick={() => handleCardClick(project.id)}
              className="cursor-pointer transition-all duration-200 hover:shadow-xl hover:scale-[1.02] border border-gray-200"
              withBorder
              shadow="sm"
              radius="lg"
              padding="lg"
            >
              <Card.Section withBorder inheritPadding py="sm">
                <Group justify="space-between" align="flex-start">
                  <Stack gap="xs" style={{ flex: 1 }}>
                    <Text size="lg" fw={700} c="dark" lineClamp={1}>
                      {project.name}
                    </Text>
                    <Text size="sm" c="dimmed" lineClamp={2}>
                      {project.description || "A칞캼klama yok"}
                    </Text>
                    <InfoItem
                      icon={IconInfoCircle}
                      value={getProjectTypeName(project.projectTypeId)}
                      color="indigo"
                    />
                  </Stack>
                  <Tooltip label="Detaylar캼 g칬r칲nt칲le">
                    <ActionIcon variant="light" color="blue" size="sm">
                      <IconInfoCircle size={16} />
                    </ActionIcon>
                  </Tooltip>
                </Group>
              </Card.Section>
              

              <Stack gap="md" mt="md">
                {/* Durum ve 칐ncelik */}
                <Group justify="space-between">
                  <Badge
                    color={statusConfig[project.status]?.color || "gray"}
                    variant="light"
                    size="sm"
                  >
                    {statusConfig[project.status]?.label || project.status || "Belirsiz"}
                  </Badge>
                  <Badge
                    color={priorityConfig[project.priority]?.color || "gray"}
                    variant="filled"
                    size="sm"
                  >
                    {priorityConfig[project.priority]?.label || project.priority || "-"}
                  </Badge>
                </Group>

                {/* Tarih Bilgileri */}
                <Group grow>
                  <InfoItem
                    icon={IconCalendar}
                    label="Ba륿ama"
                    value={formatDate(project.startDate)}
                    color="green"
                  />
                  <InfoItem
                    icon={IconCalendar}
                    label="Biti"
                    value={formatDate(project.endDate)}
                    color="red"
                  />
                </Group>

                {/* G칲칞 Bilgileri */}
                <Group grow>
                  <PowerCard
                    title="DC G칲c칲"
                    value={project.dcValue}
                    unit="kWp"
                    icon={IconBolt}
                  />
                  <PowerCard
                    title="AC G칲c칲"
                    value={project.acValue}
                    unit="kWe"
                    icon={IconBolt}
                  />
                </Group>

                {/* Panel ve 캻nverter */}
                <Group grow>
                  <InfoItem
                    icon={IconSolarPanel}
                    label="Panel"
                    value={`${project.panelCount} adet / ${project.panelPower} W`}
                    color="orange"
                  />
                  <InfoItem
                    icon={IconCpu}
                    label="캻nverter"
                    value={`${project.inverterCount} adet / ${project.inverterPower} kW`}
                    color="purple"
                  />
                </Group>

                {/* Ek Yap캼 */}
                {project.hasAdditionalStructure && (
                  <Card withBorder padding="sm" radius="md" bg="blue.0">
                    <Text size="xs" fw={600} c="blue" mb="xs">
                      EK YAPI B캻LG캻LER캻
                    </Text>
                    <Group grow>
                      <InfoItem
                        icon={IconSolarPanel}
                        label="Panel"
                        value={`${project.additionalPanelCount} / ${project.additionalPanelPower} W`}
                        color="blue"
                      />
                      <InfoItem
                        icon={IconCpu}
                        label="캻nverter"
                        value={`${project.additionalInverterCount} adet`}
                        color="blue"
                      />
                    </Group>
                    <InfoItem
                      icon={IconBolt}
                      label="DC G칲c칲"
                      value={`${project.additionalDcValue || "-"} kW`}
                      color="blue"
                    />
                  </Card>
                )}

                <Divider />

                {/* Lokasyon ve Proje T칲r칲 */}
                <Stack gap="xs">
                  <InfoItem
                    icon={IconMapPin}
                    label="Lokasyon"
                    value={`${getCityName(project.address?.cityId)} / ${getDistrictName(project.address?.districtId)}`}
                    color="teal"
                  />
                  <Group grow>
                    <InfoItem
                      icon={IconMapPin}
                      label="Ada / Parsel"
                      value={`${project.address?.ada || "-"} / ${project.address?.parsel || "-"}`}
                      color="gray"
                    />
                    
                  </Group>
                </Stack>

                {/* Olu릆urulma Tarihi */}
                <Text size="xs" c="dimmed" ta="right" fs="italic">
                  Eklendi: {formatDate(project.createdAt)}
                </Text>
              </Stack>
            </Card>
          ))
        )}
      </div>

      <ProjectDetails
        opened={modalOpen}
        onClose={() => setModalOpen(false)}
        projectId={selectedProjectId}
      />
    </div>
  );
};

export default Projects;


// proje ekleme

import { Button, Checkbox, Divider, Select, Textarea, TextInput } from '@mantine/core';
import React, { useEffect, useState } from 'react';
import 'dayjs/locale/tr';
import axios from 'axios';


const ProjectCreate = () => {
  const [hasEkYapi, setHasEkYapi] = useState(false);
  const [cities, setCities] = useState([]);
  const [districts, setDistricts] = useState([]);
  const [neighborhood, setNeighborhood] = useState([]);
  const [projectTypes, setProjectTypes] = useState([]);
  const [panelBrand, setPanelBrand] = useState([]);
  const [inverterBrand, setInverterBrand] = useState([]);

  const [formData, setFormData] = useState({
    name: "",
    description: "",
    startDate: new Date().toISOString(),
    endDate: new Date().toISOString(),
    priority: "Low",
    status: "isPlanned",
    panelCount: 0,
    panelPower: 0,
    panelBrandId: 0,
    inverterCount: 0,
    inverterPower: 0,
    inverterBrandId: 0,
    hasAdditionalStructure: false,
    additionalPanelCount: 0,
    additionalPanelPower: 0,
    additionalInverterCount: 0,
    acValue: 0,
    dcValue: 0,
    createdByUserId: 1,
    projectTypeId: 1,
    address: {
      cityId: 0,
      districtId: 0,
      neighborhoodId: 0,
      ada: "",
      parsel: ""
    }
  });

  useEffect(() => {
    const fetchData = async () => {
      const token = localStorage.getItem("token");
      const headers = { Authorization: `Bearer ${token}` };

      try {
        const [projectTypesRes, panelRes, inverterRes, citiesRes] = await Promise.all([
          axios.get("http://localhost:5000/api/projectTypes", { headers }),
          axios.get("http://localhost:5000/api/panelBrands", { headers }),
          axios.get("http://localhost:5000/api/inverterBrands", { headers }),
          axios.get("http://localhost:5000/api/cities", { headers })
        ]);

        setProjectTypes(projectTypesRes.data.map(i => ({ value: i.id.toString(), label: i.name })));
        setPanelBrand(panelRes.data.map(i => ({ value: i.id.toString(), label: i.name })));
        setInverterBrand(inverterRes.data.map(i => ({ value: i.id.toString(), label: i.name })));
        setCities(citiesRes.data.map(i => ({ value: i.id.toString(), label: i.name })));

      } catch (err) {
        console.error("Veriler al캼namad캼", err);
      }
    };

    fetchData();
  }, []);

  useEffect(() => {
    if (!formData.address.cityId) return;
    const token = localStorage.getItem("token");
    axios.get(`http://localhost:5000/api/cities/by-districts/${formData.address.cityId}`, {
      headers: { Authorization: `Bearer ${token}` },
    }).then(res => {
      setDistricts(res.data.map(i => ({ value: i.id.toString(), label: i.name })));
    }).catch(console.error);
  }, [formData.address.cityId]);

  useEffect(() => {
    if (!formData.address.districtId) return;
    const token = localStorage.getItem("token");
    axios.get(`http://localhost:5000/api/districts/by-neighborhoods/${formData.address.districtId}`, {
      headers: { Authorization: `Bearer ${token}` },
    }).then(res => {
      setNeighborhood(res.data.map(i => ({ value: i.id.toString(), label: i.name })));
    }).catch(console.error);
  }, [formData.address.districtId]);

  useEffect(() => {
    const count = parseFloat(formData.panelCount) || 0;
    const power = parseFloat(formData.panelPower) || 0;
    const dc = (count * power) / 1000;
    setFormData((prev) => ({ ...prev, dcValue: dc.toFixed(2) }));
  }, [formData.panelCount, formData.panelPower]);

  const handleSubmit = async () => {
    try {
      const token = localStorage.getItem("token");
      await axios.post("http://localhost:5000/api/projects", formData, {
        headers: { Authorization: `Bearer ${token}` },
      });
      alert("Proje ba르r캼yla kaydedildi");
    } catch (err) {
      console.error("Proje kayd캼 ba르r캼s캼z:", err);
      alert("Hata olu릆u");
    }
  };



  return (
    <div className="py-6 px-6">
      <h2 className="text-2xl font-bold  mb-6 text-ivosis-700">Proje Ekle</h2>
      <div className="border rounded-lg p-6 bg-white space-y-8 ">

        {/* GENEL B캻LG캻LER */}
        <div>
          <h6 className="text-lg font-bold text-ivosis-700 mb-4">Genel Bilgiler</h6>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">

            {/* Sol S칲tun - Proje Ad캼 ve A칞캼klama */}
            <div className="space-y-6">
              {/* Proje Ad캼 */}
              <div>
                <label className="text-natural-800 font-semibold block mb-1">
                  Proje Ad캼 <span className="text-red-500">*</span>
                </label>
                <TextInput
                  className="w-full"
                  value={formData.name}
                  onChange={(e) => setFormData({ ...formData, name: e.currentTarget.value })}
                />
              </div>

              {/* A칞캼klama */}
              <div>
                <label className="text-natural-800 font-semibold block mb-1">
                  A칞캼klama
                </label>
                <Textarea
                  placeholder="A칞캼klama yaz캼n"
                  rows={2}
                  className="w-full h-full"
                  value={formData.description}
                  onChange={(e) => setFormData({ ...formData, description: e.currentTarget.value })}
                />
              </div>
            </div>

            {/* Sa S칲tun - Di른r Bilgiler */}
            <div className="space-y-6">

              {/* Tarihler */}
              <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div>
                  <label className="text-natural-800 font-semibold block mb-1">
                    Ba륿ang캼칞 Tarihi <span className="text-red-500">*</span>
                  </label>
                  <input
                    type="date"
                    className="border rounded-md px-3 py-2 w-full"
                    value={formData.startDate.split("T")[0]}
                    onChange={(e) => setFormData({ ...formData, startDate: e.target.value })}
                  />
                </div>

                <div>
                  <label className="text-natural-800 font-semibold block mb-1">
                    Biti Tarihi <span className="text-red-500">*</span>
                  </label>
                  <input
                    type="date"
                    className="border rounded-md px-3 py-2 w-full"
                    value={formData.endDate.split("T")[0]}
                    onChange={(e) => setFormData({ ...formData, endDate: e.target.value })}
                  />
                </div>
              </div>

              {/* Durum - 칐nem - Proje T칲r칲 */}
              <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                  <label className="text-natural-800 font-semibold block mb-1">
                    Durum <span className="text-red-500">*</span>
                  </label>
                  <Select
                    placeholder="Durum Se칞in"
                    searchable
                    clearable
                    className="w-full"
                    data={[
                      { value: "isPlanned", label: "Planlan캼yor" },
                      { value: "ToDo", label: "Yap캼l캼yor" },
                      { value: "Done", label: "Tamamland캼" },
                      { value: "Canceled", label: "캻ptal" }
                    ]}
                    value={formData.status}
                    onChange={(e) => setFormData({ ...formData, status: e })}
                  />
                </div>

                <div>
                  <label className="text-natural-800 font-semibold block mb-1">
                    칐nem <span className="text-red-500">*</span>
                  </label>
                  <Select
                    placeholder="칐nem Se칞in"
                    searchable
                    clearable
                    className="w-full"
                    data={[
                      { value: "Low", label: "D칲칲k" },
                      { value: "Medium", label: "Orta" },
                      { value: "High", label: "Y칲ksek" },
                      { value: "Critical", label: "Kritik" }
                    ]}
                    value={formData.priority}
                    onChange={(e) => setFormData({ ...formData, priority: e })}
                  />
                </div>

                <div>
                  <label className="text-natural-800 font-semibold block mb-1">
                    Proje T칲r칲 <span className="text-red-500">*</span>
                  </label>
                  <Select
                    placeholder="Proje T칲r칲 Se칞in"
                    searchable
                    clearable
                    className="w-full"
                    data={projectTypes}
                    value={formData.projectTypeId.toString()}
                    onChange={(e) => setFormData({ ...formData, projectTypeId: Number(e) })}
                  />
                </div>
              </div>
            </div>
          </div>
        </div>


        <Divider />

        {/* KONUM B캻LG캻LER캻 */}
        <div className="w-full md:w-1/2 space-y-">
          <h6 className="text-lg font-bold text-ivosis-700 mb-6">Konum Bilgileri</h6>

          <div className="grid grid-cols-1 md:grid-cols-5 gap-6 mb-6">
            {/* 룐hir */}
            <div>
              <label className="text-natural-800 font-semibold block mb-1">
                룐hir <span className="text-red-500">*</span>
              </label>
              <Select
                placeholder="룐hir Se칞in"
                searchable
                clearable
                className="w-full"
                data={cities} value={formData.address.cityId.toString()} onChange={(e) => setFormData({ ...formData, address: { ...formData.address, cityId: Number(e), districtId: 0, neighborhoodId: 0 } })}
              />
            </div>

            {/* 캻l칞e */}
            <div>
              <label className="text-natural-800 font-semibold block mb-1">
                캻l칞e <span className="text-red-500">*</span>
              </label>
              <Select
                placeholder='Mahalle Se칞in'
                searchable
                clearable
                className='w-full'
                data={districts} value={formData.address.districtId.toString()} onChange={(e) => setFormData({ ...formData, address: { ...formData.address, districtId: Number(e), neighborhoodId: 0 } })}
              />
            </div>

            {/* Mahalle */}
            <div>
              <label className="text-natural-800 font-semibold block mb-1">
                Mahalle <span className="text-red-500">*</span>
              </label>
              <Select
                placeholder='Mahalle Se칞in'
                searchable
                clearable
                className='w-full'
                data={neighborhood} value={formData.address.neighborhoodId.toString()} onChange={(e) => setFormData({ ...formData, address: { ...formData.address, neighborhoodId: Number(e) } })}
              />
            </div>

            <div>
              <label className="text-natural-800 font-semibold block mb-1">
                Ada <span className="text-red-500">*</span>
              </label>
              <TextInput className="w-full" value={formData.address.ada} onChange={(e) => setFormData({ ...formData, address: { ...formData.address, ada: e.currentTarget.value } })} />
            </div>

            {/* Parsel */}
            <div>
              <label className="text-natural-800 font-semibold block mb-1">
                Parsel <span className="text-red-500">*</span>
              </label>
              <TextInput className="w-full" value={formData.address.parsel} onChange={(e) => setFormData({ ...formData, address: { ...formData.address, parsel: e.currentTarget.value } })} />
            </div>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* Ada */}

          </div>
        </div>


        <Divider />

        {/* TEKN캻K B캻LG캻LER */}
        <div className="w-full md:w-1/2 space-y-6">
          <h6 className="text-lg font-bold text-ivosis-700 mb-6">Teknik Bilgiler</h6>

          {/* Sat캼r 1 */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
            {/* Panel Say캼s캼 */}
            <div>
              <label className="text-natural-800 font-semibold block mb-1">
                Panel Say캼s캼 <span className="text-red-500">*</span>
              </label>
              <TextInput className="w-full" value={formData.panelCount} onChange={(e) => setFormData({ ...formData, panelCount: e.currentTarget.value })} />
            </div>

            {/* Panel G칲c칲 */}
            <div>
              <label className="text-natural-800 font-semibold block mb-1">
                Panel G칲c칲 <span className="text-red-500">*</span>
              </label>
              <TextInput className="w-full" value={formData.panelPower} onChange={(e) => setFormData({ ...formData, panelPower: e.currentTarget.value })} />
            </div>

            {/* Panel Markas캼 */}
            <div>
              <label className='text-natural-800 font-semibold block mb-1'>
                Panel Markas캼 <span className='text-red-500'>*</span>
              </label>
              <Select
                placeholder='Panel Markas캼 Se칞in'
                searchable
                clearable
                className='w-full'
                data={panelBrand} value={formData.panelBrandId.toString()} onChange={(e) => setFormData({ ...formData, panelBrandId: Number(e) })}
              />
            </div>

            {/* DC (kWp) */}
            <div>
              <label className="text-natural-800 font-semibold block mb-1">
                DC (kWp) <span className="text-red-500">*</span>
              </label>
              <TextInput
                className="w-full"
                value={formData.dcValue}
                readOnly
              />
            </div>
          </div>

          {/* Sat캼r 2 */}
          <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
            {/* 캻nvert칬r Say캼s캼 */}
            <div>
              <label className="text-natural-800 font-semibold block mb-1">
                캻nvert칬r Say캼s캼 <span className="text-red-500">*</span>
              </label>
              <TextInput className="w-full" value={formData.inverterCount} onChange={(e) => setFormData({ ...formData, inverterCount: e.currentTarget.value })} />
            </div>

            {/* 캻nvert칬r G칲c칲 */}
            <div>
              <label className="text-natural-800 font-semibold block mb-1">
                캻nvert칬r G칲c칲 <span className="text-red-500">*</span>
              </label>
              <TextInput className="w-full" value={formData.inverterPower} onChange={(e) => setFormData({ ...formData, inverterPower: e.currentTarget.value })} />
            </div>

            {/* 캻nvert칬r Markas캼 */}
            <div>
              <label className='text-natural-800 font-semibold block mb-1'>
                Panel Markas캼 <span className='text-red-500'>*</span>
              </label>
              <Select
                placeholder='Panel Markas캼 Se칞in'
                searchable
                clearable
                className='w-full'
                data={inverterBrand} value={formData.inverterBrandId.toString()} onChange={(e) => setFormData({ ...formData, inverterBrandId: Number(e) })}
              />
            </div>

            {/* AC (kWe) */}
            <div>
              <label className="text-natural-800 font-semibold block mb-1">
                AC (kWe) <span className="text-red-500">*</span>
              </label>
              <TextInput className="w-full" value={formData.acValue} onChange={(e) => setFormData({ ...formData, acValue: e.currentTarget.value })} />
            </div>
          </div>
        </div>


        <Divider />

        {/* EK YAPI B캻LG캻LER캻 */}
        <div className="w-full md:w-1/2 space-y-6">
          <h6 className="text-lg font-bold text-ivosis-700 mb-4">Ek Yap캼 Bilgileri</h6>

          {/* Checkbox */}
          <div className="mb-6">
            <Checkbox label="Ek Yap캼 m캼?" checked={hasEkYapi} onChange={(e) => {
              const checked = e.currentTarget.checked;
              setHasEkYapi(checked);
              setFormData({ ...formData, hasAdditionalStructure: checked });
            }} />
          </div>

          {/* Grid alanlar sadece checkbox i르retliyse g칬r칲ns칲n */}
          {hasEkYapi && (
            <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
              {/* Panel Say캼s캼 */}
              <div>
                <label className="text-natural-800 font-semibold block mb-1">
                  Panel Say캼s캼 <span className="text-red-500">*</span>
                </label>
                <TextInput className="w-full" value={formData.additionalPanelCount} onChange={(e) => setFormData({ ...formData, additionalPanelCount: Number(e.currentTarget.value) })} />
              </div>

              {/* Panel G칲c칲 */}
              <div>
                <label className='text-natural-800 font-semibold block mb-1'>
                  Panel G칲c칲 <span className='text-red-500'>*</span>
                </label>
                <TextInput className='w-full' value={formData.additionalPanelPower} onChange={(e) => setFormData({ ...formData, additionalPanelPower: Number(e.currentTarget.value) })} />
              </div>

              {/* 캻nvert칬r Say캼s캼 */}
              <div>
                <label className="text-natural-800 font-semibold block mb-1">
                  캻nvert칬r Say캼s캼 <span className="text-red-500">*</span>
                </label>
                <TextInput className="w-full" value={formData.additionalInverterCount} onChange={(e) => setFormData({ ...formData, additionalInverterCount: Number(e.currentTarget.value) })} />
              </div>
            </div>
          )}
        </div>


        {/* SUBMIT BUTTON */}
        <div className="-full md:w-1/2 space-y-6 text-center">
          <Button className="bg-green-500 hover:!bg-green-500" onClick={handleSubmit} >Projeyi Kaydet</Button>
        </div>
      </div>

    </div> //ana div
  );
};

export default ProjectCreate;
